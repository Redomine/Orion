<link rel="stylesheet" href="/assets/styles.css" type="text/css" />

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>



<div class="gameDiv" id="gameDiv" >
    <canvas id="ctx" width="800" height="800" style="border:1px solid #000000;"></canvas>
</div>

<div class="planets-popup">
    <div class="planets-popup-content" id="planetDiv" style="display:none;">
		<canvas id="plt" width="500" height="300" style="border:1px solid #000000;"></canvas>
		<button id="close-planets">Close</button>
	</div>
</div>

<script>
	var gameField = document.getElementById("ctx");
	var planetDiv = document.getElementById("planetDiv");
    var ctx = document.getElementById("ctx").getContext("2d");
	var socket = io();

	var img = {};
	img.space = new Image();
	img.space.src = '/img/space.png';

	ctx.font = '12px Arial';
	ctx.fillStyle = "white";
    socket.on('render_map', function(data){
		ctx.clearRect(0,0,800,800);
		ctx.drawImage(img.space,0,0);
		for (i in data.star_systems) {
			img.star = new Image();
			img.star.src = data.star_systems[i][2];	
			star_size = data.star_systems[i][5];
			star_x = data.star_systems[i][3];
			star_y = data.star_systems[i][4];
			star_name = data.star_systems[i][1];
			ctx.drawImage(img.star,star_x - star_size,star_y - star_size, star_size, star_size);	
			ctx.fillText(star_name, star_x - star_size,star_y+30 - star_size);
		}
	})

	socket.on('get_star_name', function(data){
		gameField.addEventListener('mousedown' ,onDown, false);
		function onDown(event) {
			cx = event.pageX;
			cy = event.pageY;

			for (i in data.star_systems){
				star_x = data.star_systems[i][3]
				star_y = data.star_systems[i][4]
				star_name = data.star_systems[i][1];
				if ((cx <= star_x + 20 && cx >= star_x - 20) && (cy <= star_y + 20 && cy >= star_y -20)){
					console.log(star_name);
					planetDiv.style.display = 'inline-block';
				}
			}
		}
	});


</script>